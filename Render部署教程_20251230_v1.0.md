# Render 部署教程

**文档版本**: v1.0  
**创建日期**: 2025-12-30  
**适用范围**: 飞书文档转换 Markdown 工具

---

## 目录

1. [Render 简介](#render-简介)
2. [准备工作](#准备工作)
3. [部署步骤](#部署步骤)
4. [配置环境变量](#配置环境变量)
5. [访问应用](#访问应用)
6. [常见问题](#常见问题)

---

## Render 简介

Render 是一个现代化的云平台，提供：
- ✅ **完全免费**（Web 服务免费）
- ✅ **无需绑定银行卡**
- ✅ 支持 Docker 部署
- ✅ 自动 HTTPS
- ✅ 从 GitHub 自动部署
- ✅ 简单易用的界面
- ✅ 自动重启失败的服务

---

## 准备工作

### 1. 注册 Render 账户

1. 访问 https://render.com
2. 点击 "Sign Up" 按钮
3. 使用以下方式注册：
   - GitHub 账户（推荐）
   - Google 账户
   - Email 注册

### 2. 准备飞书应用凭证

确保您有以下信息：
- **FEISHU_APP_ID**: `cli_a6727c4ffc71d00b`
- **FEISHU_APP_SECRET**: `dt7LyzH6HOexxH4z9ssXpghYgE8PIvSI`

### 3. 确保代码已推送到 GitHub

您的代码应该在：https://github.com/aramisjiang-wq/feishu2md.git

---

## 部署步骤

### 步骤 1: 登录 Render

1. 访问 https://dashboard.render.com
2. 使用您的账户登录

### 步骤 2: 创建新的 Web Service

1. 点击右上角的 "+" 按钮
2. 选择 "New Web Service"

### 步骤 3: 连接 GitHub 仓库

1. 在 "Connect a repository" 部分
2. 搜索您的仓库：`feishu2md`
3. 点击 "Connect" 按钮

### 步骤 4: 配置部署设置

#### 基本设置

- **Name**: `feishu2md`
- **Region**: 选择离您最近的区域（如 Singapore）
- **Branch**: `main`
- **Runtime**: `Docker`
- **Root Directory**: 留空（默认）

#### 构建设置

- **Docker Context**: 留空（默认）
- **Dockerfile Path**: `Dockerfile`

#### 环境设置

- **Instance Type**: `Free`
- **Instances**: `1`

### 步骤 5: 配置环境变量

在 "Environment Variables" 部分，添加以下变量：

| Key | Value | Sensitive |
|-----|-------|-----------|
| `FEISHU_APP_ID` | `cli_a6727c4ffc71d00b` | ✅ Yes |
| `FEISHU_APP_SECRET` | `dt7LyzH6HOexxH4z9ssXpghYgE8PIvSI` | ✅ Yes |
| `GIN_MODE` | `release` | ❌ No |
| `PORT` | `8080` | ❌ No |

**重要提示**：
- 勾选 `FEISHU_APP_ID` 和 `FEISHU_APP_SECRET` 的 "Sensitive" 选项
- 这样可以保护您的敏感信息

### 步骤 6: 创建 Web Service

1. 点击底部的 "Create Web Service" 按钮
2. 等待部署完成（通常需要 2-5 分钟）

---

## 配置环境变量

### 在部署后修改环境变量

如果部署后需要修改环境变量：

1. 进入您的 Web Service 页面
2. 点击 "Environment" 标签
3. 点击 "Add Environment Variable"
4. 添加或修改变量
5. 点击 "Save Changes"
6. 服务会自动重启

---

## 访问应用

### 获取应用地址

部署成功后，Render 会给您一个 URL，例如：
- `https://feishu2md.onrender.com`

### 访问应用

1. 在浏览器中打开应用地址
2. 您应该能看到 "飞书文档转换md" 的界面
3. 测试功能：输入飞书文档 URL，点击 "Download"

---

## 常见问题

### 问题 1: 部署失败

**症状**: 部署过程中出现错误

**解决方案**:
1. 检查 Dockerfile 是否存在
2. 检查 GitHub 仓库是否包含所有必要文件
3. 查看 Render 的部署日志

**查看日志**:
1. 进入 Web Service 页面
2. 点击 "Logs" 标签
3. 查看详细的错误信息

### 问题 2: 应用无法启动

**症状**: 部署成功但应用无法访问

**解决方案**:
1. 检查环境变量是否正确设置
2. 检查端口是否设置为 `8080`
3. 查看应用日志

### 问题 3: 应用响应慢

**症状**: 应用访问速度慢

**解决方案**:
Render 免费版会休眠，首次访问需要唤醒时间（通常 10-30 秒）。

**解决方法**:
- 升级到付费版（Starter $7/月）
- 使用外部监控服务定期 ping 应用

### 问题 4: 环境变量未生效

**症状**: 应用无法连接飞书 API

**解决方案**:
1. 检查环境变量名称是否正确
2. 检查环境变量值是否正确
3. 重新部署服务

**重新部署**:
1. 进入 Web Service 页面
2. 点击 "Manual Deploy"
3. 选择 "Clear build cache & deploy"

### 问题 5: 应用自动休眠

**症状**: 一段时间不使用后应用无法访问

**解决方案**:
Render 免费版会在 15 分钟无活动后自动休眠。

**解决方法**:
- 这是免费版的正常行为
- 升级到付费版可以避免休眠
- 使用外部监控服务定期访问应用

---

## 高级配置

### 配置自定义域名

1. 进入 Web Service 页面
2. 点击 "Custom Domains"
3. 点击 "Add Domain"
4. 输入您的域名
5. 按照提示配置 DNS

### 配置健康检查

Render 会自动检查应用健康状态，无需额外配置。

应用已包含 `/health` 端点：

```go
router.GET("/health", func(c *gin.Context) {
    c.JSON(http.StatusOK, gin.H{
        "status": "ok",
    })
})
```

### 配置自动部署

Render 默认会在您推送代码到 GitHub 后自动部署。

**禁用自动部署**:
1. 进入 Web Service 页面
2. 点击 "Settings"
3. 取消勾选 "Auto-Deploy"

---

## 监控和日志

### 查看实时日志

1. 进入 Web Service 页面
2. 点击 "Logs" 标签
3. 选择 "Real-time"
4. 查看实时日志输出

### 查看历史日志

1. 进入 Web Service 页面
2. 点击 "Logs" 标签
3. 选择 "Past deploys"
4. 选择部署版本

### 查看指标

1. 进入 Web Service 页面
2. 点击 "Metrics" 标签
3. 查看 CPU、内存、网络使用情况

---

## 更新应用

### 自动更新

1. 修改代码
2. 推送到 GitHub
3. Render 会自动检测并部署

### 手动更新

1. 进入 Web Service 页面
2. 点击 "Manual Deploy"
3. 选择 "Deploy latest commit"

---

## 备份和恢复

### 备份数据

Render 不提供数据备份功能，建议：
- 定期导出重要数据
- 使用 GitHub 保存代码

### 恢复应用

1. 从 GitHub 克隆代码
2. 在 Render 上重新部署

---

## 费用说明

### 免费版

- ✅ Web 服务：完全免费
- ✅ 自动 HTTPS：免费
- ✅ 自动部署：免费
- ⚠️ 休眠时间：15 分钟无活动后休眠
- ⚠️ 唤醒时间：10-30 秒

### 付费版

- **Starter**: $7/月
  - 无休眠
  - 更快响应
  - 更多资源

- **Standard**: $25/月
  - 更多资源
  - 更高性能

- **Pro**: $100/月
  - 最高性能
  - 专属支持

---

## 安全建议

1. **保护敏感信息**
   - 使用环境变量存储 API 密钥
   - 勾选 "Sensitive" 选项

2. **启用 HTTPS**
   - Render 自动提供 HTTPS
   - 无需额外配置

3. **限制访问**
   - 考虑添加认证机制
   - 使用 Render 的访问控制

4. **定期更新**
   - 及时更新依赖
   - 定期检查安全漏洞

---

## 性能优化

### 1. 使用缓存

在应用中启用缓存可以减少 API 调用。

### 2. 优化数据库查询

如果使用数据库，确保查询优化。

### 3. 使用 CDN

Render 自动提供 CDN，无需额外配置。

---

## 故障排除

### 检查服务状态

1. 进入 Web Service 页面
2. 查看服务状态（Live / Deploying / Degraded / Down）

### 重启服务

1. 进入 Web Service 页面
2. 点击 "Manual Deploy"
3. 选择 "Restart"

### 联系支持

如果遇到无法解决的问题：
1. 查看 Render 文档：https://render.com/docs
2. 联系 Render 支持：support@render.com

---

## 总结

通过本教程，您应该能够：

✅ 在 Render 上部署 Go 应用  
✅ 配置环境变量  
✅ 访问 Web 界面  
✅ 解决常见问题  
✅ 监控应用状态  

---

## 相关资源

- **Render 官方文档**: https://render.com/docs
- **Render 定价**: https://render.com/pricing
- **Docker 官方文档**: https://docs.docker.com/
- **Go 语言官方文档**: https://golang.org/doc/
- **Gin 框架文档**: https://gin-gonic.com/docs/

---

**最后更新**: 2025-12-30  
**维护者**: AI 开发助手  
**版本**: v1.0
